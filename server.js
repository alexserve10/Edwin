const express = require('express'); const http = require('http'); const WebSocket = require('ws'); const net = require('net'); const app = express(); const PORT = process.env.PORT || 8080; const CONFIG = { sni: 'fonts.gstatic.com', target_host: 'fonts.gstatic.com', target_port: 443, payload: 'GET / HTTP/1.1[crlf]Host:[host][crlf]Connection: Upgrade[crlf]Upgrade: Websocket[crlf][crlf]' }; app.use((req, res, next) => { res.setHeader('Access-Control-Allow-Origin', '*'); res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS'); res.setHeader('Access-Control-Allow-Headers', '*'); next(); }); app.get('/', (req, res) => { res.json({ status: 'âœ… ONLINE', server: 'VPN Proxy Server', puerto: '443 (HTTPS)', sni: CONFIG.sni, target: ${CONFIG.target_host}:${CONFIG.target_port}, websocket: wss://${req.get('host')}/ws, payload_endpoint: https://${req.get('host')}/payload }); }); app.get('/health', (req, res) => { res.send('OK'); }); app.get('/payload', (req, res) => { const host = req.get('host'); const payload = CONFIG.payload .replace(/\[crlf\]/g, '\r\n') .replace(/\[host\]/g, host); res.json({ servidor: https://${host}, puerto: 443, sni: CONFIG.sni, websocket: wss://${host}/ws, payload: payload.replace(/\r\n/g, '[crlf]') }); }); const server = http.createServer(app); const wss = new WebSocket.Server({ server, path: '/ws' }); wss.on('connection', (ws, req) => { const socket = net.connect(CONFIG.target_port, CONFIG.target_host, () => { const payload = CONFIG.payload .replace(/\[crlf\]/g, '\r\n') .replace(/\[host\]/g, req.headers.host); socket.write(payload); }); ws.on('message', data => socket.write(data)); socket.on('data', data => ws.send(data)); ws.on('close', () => socket.destroy()); socket.on('close', () => ws.close()); }); server.listen(PORT, '0.0.0.0', () => { console.log(Servidor iniciado en puerto ${PORT}); }); 
